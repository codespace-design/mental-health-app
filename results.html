<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Results</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
  <h2>Results for <span id="userName"></span></h2>
  <canvas id="resultsChart"></canvas>
  <div id="metricsContainer"></div>
  <button onclick="window.location.href='meditation.html'">Go to Relaxation ðŸŽ¶</button>
</div>

<script>
const user = localStorage.getItem("nickname") || "Friend";
document.getElementById("userName").textContent = user;

const results = JSON.parse(localStorage.getItem("quizResults")) || [];
const scoresByMetric = {};
const maxScoreByMetric = {};

results.forEach(r => {
  if (!scoresByMetric[r.metric]) scoresByMetric[r.metric] = 0;
  scoresByMetric[r.metric] += r.score;
  if (!maxScoreByMetric[r.metric]) maxScoreByMetric[r.metric] = 0;
  maxScoreByMetric[r.metric] += 3;
});

const ctx = document.getElementById("resultsChart").getContext("2d");
new Chart(ctx, {
  type: "radar",
  data: {
    labels: Object.keys(scoresByMetric),
    datasets: [{
      label: "Your Scores",
      data: Object.values(scoresByMetric),
      backgroundColor: "rgba(0,255,255,0.2)",
      borderColor: "#00ffff",
      borderWidth: 2,
      pointBackgroundColor: "#fff"
    }]
  },
  options: {
    responsive: true,
    scales: {
      r: {
        angleLines: { color: "rgba(255,255,255,0.2)" },
        grid: { color: "rgba(255,255,255,0.2)" },
        suggestedMin: 0,
        suggestedMax: Math.max(...Object.values(maxScoreByMetric)),
        pointLabels: { color: "#00ffff" }
      }
    },
    plugins: { legend: { labels: { color: "#00ffff" } } }
  }
});

const metricsContainer = document.getElementById("metricsContainer");
for(const [metric, score] of Object.entries(scoresByMetric)){
  const max = maxScoreByMetric[metric];
  const percent = Math.round((score/max)*100);
  const div = document.createElement("div");
  div.className = "metric";
  div.innerHTML = `<strong>${metric.toUpperCase()}</strong>: ${score}/${max}
    <div class="progress-container">
      <div class="progress-fill" style="width:${percent}%;"></div>
    </div>`;
  metricsContainer.appendChild(div);
}
</script>
</body>
</html>
